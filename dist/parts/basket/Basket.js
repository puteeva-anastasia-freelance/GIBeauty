!function(){"use strict";class e{constructor(){this.pathToProductsImages="img/dist/products",this.productsInBasket=[{id:11,quantity:1},{id:6,quantity:3},{id:15,quantity:2}],this.costPaidDelivery=2300,this.minSummaProductsForFreeDelivery=2e4,this.totalSummaProducts=0,this.costDelivery=0,this.inTotalSummaEl=document.querySelector("#inTotalSumma"),this.promocodeInputEl=document.querySelector(".basket__promocode-input"),this.linkInShopEl=document.querySelector(".transitions__link-in-shop"),this.promocodeButtonEl=document.querySelector(".basket__promocode-button"),this.promocodeTextEl=document.querySelector(".basket__promocode-txt"),this.inTotalSummaWithSaleEl=document.querySelector("#inTotalSummaWithSale")}renderBasket(t){this.renderCardProduct(this.productsInBasket,t),this.totalSummaProducts=this.setTotalQuantityAndSummaProducts(t),this.costDelivery=this.setCostDelivery(this.totalSummaProducts),this.inTotalSumma=this.setInTotalSumma(this.totalSummaProducts,this.costDelivery),this.addInputQuantityChangeListeners(t),this.addButtonPutAwayClickListeners(t),this.addPromocodeInputFocusListeners(),this.addButtonSendPromocodeClickListeners(promocodes,t)}setInTotalSumma(t,e){t+=e;return this.inTotalSummaEl.textContent=this.formatNumberAndAddCurrencySign(t),t}setCostDelivery(t){let e=0;var s=document.querySelector("#costDelivery");return e=t+this.costPaidDelivery>=this.minSummaProductsForFreeDelivery?0:this.costPaidDelivery,s.textContent=this.formatNumberAndAddCurrencySign(e),e}addButtonPutAwayClickListeners(a){let o=document.querySelectorAll(".basket__row");var t=[];for(let s=0;s<o.length;s++)t[s]=o[s].querySelectorAll(".basket__put-away"),t[s].forEach(t=>{t.addEventListener("click",t=>{let e=+t.currentTarget.closest(".basket__row").dataset.productId;t=this.productsInBasket.findIndex(t=>t.id===e);-1!==t&&this.productsInBasket.splice(t,1),o[s].remove(),this.isBasketEmpty(),this.totalSummaProducts=this.setTotalQuantityAndSummaProducts(a),this.costDelivery=this.setCostDelivery(this.totalSummaProducts),this.inTotalSumma=this.setInTotalSumma(this.totalSummaProducts,this.costDelivery)})})}isBasketEmpty(){0==this.productsInBasket.length&&(window.location.href="index.html")}addInputQuantityChangeListeners(o){var e=[],s=document.querySelectorAll(".basket__row");for(let t=0;t<s.length;t++)e[t]=s[t].querySelectorAll(".choose-quantity__input"),e[t].forEach(t=>{t.addEventListener("input",t=>{let e=+t.currentTarget.closest(".basket__row").dataset.productId;var s=this.productsInBasket.findIndex(t=>t.id===e),a=+t.currentTarget.dataset.maxCount;t.currentTarget.value>a?this.productsInBasket[s].quantity=a:0==t.currentTarget.value?this.productsInBasket[s].quantity=1:this.productsInBasket[s].quantity=+t.currentTarget.value,this.totalSummaProducts=this.setTotalQuantityAndSummaProducts(o),this.costDelivery=this.setCostDelivery(this.totalSummaProducts),this.inTotalSumma=this.setInTotalSumma(this.totalSummaProducts,this.costDelivery)})})}setTotalQuantityAndSummaProducts(e){var s=[],a=[],o=document.querySelectorAll(".basket__row");for(let t=0;t<o.length;t++)this.getSummaProducts(t,e),s[t]=this.productsInBasket[t].quantity,a[t]=this.productsInBasket[t].summa;return this.getTotalQuantityProducts(s),this.getTotalSummaProducts(a)}getSummaProducts(t,e){var s=this.productsInBasket[t].quantity,a=this.productsInBasket[t].id,o=document.querySelectorAll(".basket__row")[t].querySelectorAll(".basket__summa");let i=s*e[a].price;return this.productsInBasket[t].summa=i,o.forEach(t=>{t.textContent=this.formatNumberAndAddCurrencySign(i)}),i}getTotalQuantityProducts(t){let e=0;var s,a=document.querySelector(".main-header__basket-quantity");for(s of t)e+=s;a.textContent=e}getTotalSummaProducts(t){let e=0;var s,a=document.querySelector("#totalSummaProducts");for(s of t)e+=s;return a.textContent=this.formatNumberAndAddCurrencySign(e),e}getPriceProductMarkup(t){return`<span class="basket__price">${this.formatNumberAndAddCurrencySign(t.price)}</span>	`}getPriceOldProductMarkup(t){return null!=t.priceOld?`<span class="basket__price-old">${this.formatNumberAndAddCurrencySign(t.priceOld)}</span>`:""}renderCardProduct(e,s){for(let t=0;t<e.length;t++){var a=s[e[t].id],o=e[t].id,i=e[t].quantity,r=this.getPriceProductMarkup(a),n=this.getPriceOldProductMarkup(a),o=`<div class="basket__row" data-product-id="${o}">
					<div class="basket__col-1">
					<img src="${this.pathToProductsImages}/${a.category}/${a.imageSmall}" alt="${a.name}" width="279" height="257" class="basket__img">
					<button type="button" class="basket__put-away basket__put-away_bottom">
						<svg width="13" height="13" viewBox="0 0 13 13" fill="none" xmlns="http://www.w3.org/2000/svg" class="basket__put-away-icon">
							<line x1="12.3536" y1="0.353553" x2="0.353554" y2="12.3536" stroke="black"/>
							<line x1="0.353553" y1="0.646447" x2="12.3536" y2="12.6464" stroke="black"/>
						</svg>
						убрать	
					</button>
					</div>
					<div class="basket__col-2">
					<div>
						<a href="product-card.html#${o}" class="h5 basket__name">${a.name}</a>
						<p class="basket__desc">${a.shortDescription}</p>
					</div>
					<button type="button" class="basket__put-away">
						<svg width="13" height="13" viewBox="0 0 13 13" fill="none" xmlns="http://www.w3.org/2000/svg" class="basket__put-away-icon">
							<line x1="12.3536" y1="0.353553" x2="0.353554" y2="12.3536" stroke="black"/>
							<line x1="0.353553" y1="0.646447" x2="12.3536" y2="12.6464" stroke="black"/>
						</svg>
						убрать	
					</button>
					<div class="basket__col-7">
						${r}
						${n}
					</div>
					<div class="basket__col-8">
						<div class="choose-quantity basket__choose-quantity">
							<button type="button" class="choose-quantity__button minus">-</button>
							<input type="text" class="basket__choose-quantity-input choose-quantity__input" value="${i}" data-max-count="${a.quantity}" aria-label="Поле для ввода количества товаров">
							<button type="button" class="choose-quantity__button plus">+</button>
						</div>
						<div class="basket__col-6">
							<span class="basket__subtitle">сумма:</span>	
							<span class="basket__summa"></span>	
							<span class="basket__summa-with-sale"></span>	
						</div>
					</div>
					</div>
					<div class="basket__col-3">
					${r}
					${n}
					</div>
					<div class="basket__col-4">
					<div class="choose-quantity basket__choose-quantity">
						<button type="button" class="choose-quantity__button minus">-</button>
						<input type="text" class="basket__choose-quantity-input choose-quantity__input" value="${i}" data-max-count="${a.quantity}" aria-label="Поле для ввода количества товаров">
						<button type="button" class="choose-quantity__button plus">+</button>
					</div>
					<div class="basket__col-6">
						<span class="basket__subtitle">сумма:</span>	
						<span class="basket__summa"></span>	
						<span class="basket__summa-with-sale"></span>	
					</div>
					</div>
					<div class="basket__col-5">
					<span class="basket__summa"></span>	
					<span class="basket__summa-with-sale"></span>	
					</div>
					</div>`;document.querySelector(".basket__table").insertAdjacentHTML("beforeend",o)}}changeAttributesElements(){this.changeTextPlaceholderPromocode(window.innerWidth),this.changeTextTransitionsLink(window.innerWidth),this.addWidthResizeListener()}addWidthResizeListener(){let e=window.innerWidth;window.addEventListener("resize",()=>{var t=window.innerWidth;t!=e&&(e=t,this.changeTextPlaceholderPromocode(e),this.changeTextTransitionsLink(e))})}changeTextPlaceholderPromocode(t){let e="";e=t<=768?"Введите скидочный код":t<=1600?"Введите ваш скидочный код":"Введите ваш скидочный код, чтобы получить скидку",this.setTextPlaceholder(e)}setTextPlaceholder(t){this.promocodeInputEl.setAttribute("placeholder",t)}changeTextTransitionsLink(t){this.linkInShopEl.text=t<=450?"Вернуться":"Вернуться в магазин"}formatNumberAndAddCurrencySign(t){return t.toString().replace(/(\d)(?=(\d\d\d)+([^\d]|$))/g,"$1 ")+" ₽"}renderPercentSale(t,e,s,a,o,i,r){null==t?(this.productsInBasket[e].summa=s,a.forEach(t=>{t.classList.add("basket__summa-without-sale"),t.classList.remove("basket__summa")}),o.forEach(t=>{t.textContent=this.formatNumberAndAddCurrencySign(s)}),i.forEach(t=>{t.textContent=this.formatNumberAndAddCurrencySign(r)})):(this.productsInBasket[e].summa=r,i.forEach(t=>{t.classList.add("basket__summa"),t.classList.remove("basket__summa-without-sale")}),o.forEach(t=>{t.textContent=""}))}renderPercentSaleForAllProducts(t,e,s,a,o){t.forEach(t=>{t.classList.add("basket__summa-without-sale"),t.classList.remove("basket__summa")}),a.forEach(t=>{t.textContent=this.formatNumberAndAddCurrencySign(o)}),e.forEach(t=>{t.classList.add("basket__summa-with-sale"),t.textContent=this.formatNumberAndAddCurrencySign(s)})}renderFixedSale(t,e){t.forEach(t=>{t.classList.add("basket__summa"),t.classList.remove("basket__summa-without-sale")}),e.forEach(t=>{t.textContent=""})}setSale(e,s){let a=0;var o=document.querySelectorAll(".basket__row");for(let t=0;t<o.length;t++){var i=s[this.productsInBasket[t].id].priceOld,r=o[t],n=r.querySelectorAll(".basket__summa"),l=r.querySelectorAll(".basket__summa-with-sale"),u=r.querySelectorAll(".basket__summa-without-sale"),d=this.getSummaProducts(t,s),c=Math.round(d*(100-e.percent)/100);switch(this.productsInBasket[t].summa=c,this.inTotalSummaEl.classList.add("basket__summa-without-sale"),this.inTotalSummaWithSaleEl.classList.add("basket__summa"),e.category){case"percent":this.renderPercentSale(i,t,c,n,l,u,d);break;case"all":this.renderPercentSaleForAllProducts(n,l,c,u,d);break;case"fixed":this.renderFixedSale(u,l)}}this.productsInBasket.forEach(t=>{a+=t.summa}),this.costDelivery=this.setCostDelivery(a),this.inTotalSummaWithSaleEl.textContent=this.formatNumberAndAddCurrencySign(a-e.summa+this.costDelivery),this.inTotalSummaEl.textContent==this.inTotalSummaWithSaleEl.textContent&&(this.inTotalSummaWithSaleEl.textContent="",this.inTotalSummaEl.classList.remove("basket__summa-without-sale"),this.inTotalSummaEl.classList.add("basket__summa"),this.promocodeTextEl.textContent=`Промокод ${e.name.toUpperCase()} не распространяется на акционные товары`)}renderSale(e,s){var a=this.promocodeInputEl.value.trim();if(""!=a)for(let t=0;t<e.length;t++){if(e[t].name.toUpperCase()==a.toUpperCase())return this.promocodeTextEl.textContent=`Промокод ${e[t].name.toUpperCase()} применен!`,this.totalSummaProducts>=e[t].minSummaOrder?void this.setSale(e[t],s):(this.promocodeTextEl.innerHTML=`<svg class="" width="14" height="14" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M6 11C8.76142 11 11 8.76142 11 6C11 3.23858 8.76142 1 6 1C3.23858 1 1 3.23858 1 6C1 8.76142 3.23858 11 6 11ZM6 12C9.31371 12 12 9.31371 12 6C12 2.68629 9.31371 0 6 0C2.68629 0 0 2.68629 0 6C0 9.31371 2.68629 12 6 12ZM6.85714 8.57143C6.85714 9.04482 6.47339 9.42857 6 9.42857C5.52661 9.42857 5.14286 9.04482 5.14286 8.57143C5.14286 8.09804 5.52661 7.71429 6 7.71429C6.47339 7.71429 6.85714 8.09804 6.85714 8.57143ZM6.85714 3H5.14286V6.85714H6.85714V3Z" fill="currentColor"></path></svg>Промокод ${e[t].name.toUpperCase()} действует на сумму от `+this.formatNumberAndAddCurrencySign(e[t].minSummaOrder),this.inTotalSummaWithSaleEl.textContent="",this.inTotalSummaEl.classList.remove("basket__summa-without-sale"),void this.inTotalSummaEl.classList.add("basket__summa"));this.promocodeTextEl.innerHTML='<svg class="" width="14" height="14" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M6 11C8.76142 11 11 8.76142 11 6C11 3.23858 8.76142 1 6 1C3.23858 1 1 3.23858 1 6C1 8.76142 3.23858 11 6 11ZM6 12C9.31371 12 12 9.31371 12 6C12 2.68629 9.31371 0 6 0C2.68629 0 0 2.68629 0 6C0 9.31371 2.68629 12 6 12ZM6.85714 8.57143C6.85714 9.04482 6.47339 9.42857 6 9.42857C5.52661 9.42857 5.14286 9.04482 5.14286 8.57143C5.14286 8.09804 5.52661 7.71429 6 7.71429C6.47339 7.71429 6.85714 8.09804 6.85714 8.57143ZM6.85714 3H5.14286V6.85714H6.85714V3Z" fill="currentColor"></path></svg>Промокод не действителен'}else this.promocodeTextEl.innerHTML='<svg class="" width="14" height="14" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M6 11C8.76142 11 11 8.76142 11 6C11 3.23858 8.76142 1 6 1C3.23858 1 1 3.23858 1 6C1 8.76142 3.23858 11 6 11ZM6 12C9.31371 12 12 9.31371 12 6C12 2.68629 9.31371 0 6 0C2.68629 0 0 2.68629 0 6C0 9.31371 2.68629 12 6 12ZM6.85714 8.57143C6.85714 9.04482 6.47339 9.42857 6 9.42857C5.52661 9.42857 5.14286 9.04482 5.14286 8.57143C5.14286 8.09804 5.52661 7.71429 6 7.71429C6.47339 7.71429 6.85714 8.09804 6.85714 8.57143ZM6.85714 3H5.14286V6.85714H6.85714V3Z" fill="currentColor"></path></svg>Введите промокод'}addButtonSendPromocodeClickListeners(e,s){this.promocodeButtonEl.addEventListener("click",()=>{this.renderSale(e,s),document.querySelectorAll(".basket__put-away").forEach(t=>{t.addEventListener("click",()=>{this.renderSale(e,s)})}),document.querySelectorAll(".choose-quantity__input").forEach(t=>{t.addEventListener("input",()=>{this.renderSale(e,s)})})})}addPromocodeInputFocusListeners(){let t=document.createElement("style");t.innerText='.basket__promocode-inner::after{content: ""}',this.promocodeInputEl.addEventListener("focus",()=>{document.body.appendChild(t)}),this.promocodeInputEl.addEventListener("blur",()=>{document.body.removeChild(t)})}}window.addEventListener("load",()=>{var t=new e;t.renderBasket(products),t.changeAttributesElements()})}();